<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Genetech Solutions - Mail Agent Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- Include Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
--primary: #c62828;
--primary-dark: #b71c1c;
--secondary: #d32f2f;
--accent: #ef5350;
--light: #f8f9fa;
--dark: #212529;
--gray: #6c757d;
--success: #4caf50;
--danger: #f44336;
--warning: #ff9800;
--info: #2196f3;
--shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
--transition: all 0.3s ease;
}
* {
margin: 0;
padding: 0;
box-sizing: border-box;
}
body {
font-family: 'Inter', sans-serif;
background: linear-gradient(135deg, #f5f7fa 0%, #e4efe9 100%);
color: var(--dark);
min-height: 100vh;
}
.container {
max-width: 1400px;
margin: 0 auto;
padding: 20px;
}
.header {
background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
color: white;
padding: 20px;
border-radius: 12px;
margin-bottom: 30px;
box-shadow: var(--shadow);
display: flex;
justify-content: space-between;
align-items: center;
}
.header h1 {
font-size: 28px;
font-weight: 600;
}
.header .logo {
width: 50px;
height: 50px;
background: rgba(255, 255, 255, 0.2);
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
font-size: 24px;
}
.dashboard {
display: grid;
grid-template-columns: 1fr 2fr;
gap: 20px;
margin-bottom: 30px;
}
.stats-card {
background: white;
border-radius: 12px;
padding: 20px;
box-shadow: var(--shadow);
height: fit-content;
}
.stats-card h2 {
font-size: 20px;
margin-bottom: 20px;
color: var(--primary);
}
.stat-item {
display: flex;
justify-content: space-between;
padding: 12px 0;
border-bottom: 1px solid #eee;
}
.stat-item:last-child {
border-bottom: none;
}
.stat-label {
font-weight: 500;
color: var(--gray);
}
.stat-value {
font-weight: 600;
color: var(--dark);
}
.charts-card {
background: white;
border-radius: 12px;
padding: 20px;
box-shadow: var(--shadow);
}
.charts-card h2 {
font-size: 20px;
margin-bottom: 20px;
color: var(--primary);
}
.charts-container {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 20px;
}
.chart {
text-align: center;
position: relative;
}
.chart h3 {
margin-bottom: 15px;
color: var(--dark);
font-size: 16px;
}
.chart canvas {
max-width: 100%;
height: 250px !important;
}
.leads-section {
background: white;
border-radius: 12px;
padding: 20px;
box-shadow: var(--shadow);
}
.leads-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
}
.leads-header h2 {
font-size: 20px;
color: var(--primary);
}
.search-box {
display: flex;
align-items: center;
background: var(--light);
border-radius: 30px;
padding: 8px 15px;
width: 300px;
}
.search-box input {
border: none;
background: none;
outline: none;
width: 100%;
font-family: inherit;
}
.search-box i {
color: var(--gray);
margin-right: 10px;
}
.leads-table {
width: 100%;
border-collapse: collapse;
}
.leads-table th {
background: var(--light);
padding: 12px 15px;
text-align: left;
font-weight: 600;
color: var(--dark);
border-bottom: 2px solid #eee;
}
.leads-table td {
padding: 12px 15px;
border-bottom: 1px solid #eee;
}
.leads-table tr:hover {
background: rgba(67, 97, 238, 0.05);
}
.status-badge {
display: inline-block;
padding: 4px 10px;
border-radius: 20px;
font-size: 12px;
font-weight: 500;
}
.status-new {
background: rgba(76, 175, 80, 0.1);
color: var(--success);
}
.status-contacted {
background: rgba(33, 150, 243, 0.1);
color: var(--info);
}
.status-qualified {
background: rgba(255, 152, 0, 0.1);
color: var(--warning);
}
.status-closed {
background: rgba(244, 67, 54, 0.1);
color: var(--danger);
}
.action-buttons {
display: flex;
gap: 10px;
}
.btn {
padding: 6px 12px;
border: none;
border-radius: 6px;
font-size: 12px;
font-weight: 500;
cursor: pointer;
transition: var(--transition);
display: flex;
align-items: center;
gap: 5px;
}
.btn-primary {
background: var(--primary);
color: white;
}
.btn-primary:hover {
background: var(--primary-dark);
}
.btn-secondary {
background: var(--light);
color: var(--dark);
border: 1px solid #ddd;
}
.btn-secondary:hover {
background: #e9ecef;
}
.modal {
display: none;
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.5);
z-index: 1000;
justify-content: center;
align-items: center;
}
.modal-content {
background: white;
border-radius: 12px;
width: 90%;
max-width: 600px;
max-height: 90vh;
overflow-y: auto;
box-shadow: var(--shadow);
}
.modal-header {
padding: 20px;
border-bottom: 1px solid #eee;
display: flex;
justify-content: space-between;
align-items: center;
}
.modal-header h3 {
font-size: 18px;
color: var(--primary);
}
.modal-close {
background: none;
border: none;
font-size: 24px;
cursor: pointer;
color: var(--gray);
}
.modal-body {
padding: 20px;
}
.modal-footer {
padding: 15px 20px;
border-top: 1px solid #eee;
display: flex;
justify-content: flex-end;
gap: 10px;
}
.form-group {
margin-bottom: 15px;
}
.form-group label {
display: block;
margin-bottom: 5px;
font-weight: 500;
color: var(--dark);
}
.form-group input,
.form-group select,
.form-group textarea {
width: 100%;
padding: 10px 15px;
border: 1px solid #ddd;
border-radius: 8px;
font-family: inherit;
font-size: 14px;
transition: var(--transition);
}
.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
border-color: var(--primary);
outline: none;
box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
}
.form-group textarea {
resize: vertical;
min-height: 100px;
}
.email-preview {
background: var(--light);
border-radius: 8px;
padding: 15px;
margin-top: 15px;
border: 1px solid #ddd;
}
.email-preview h4 {
margin-bottom: 10px;
color: var(--primary);
}
.email-content {
white-space: pre-wrap;
font-family: monospace;
font-size: 14px;
line-height: 1.5;
}
.notification {
position: fixed;
top: 20px;
right: 20px;
padding: 15px 20px;
border-radius: 8px;
color: white;
font-weight: 500;
box-shadow: var(--shadow);
z-index: 1001;
opacity: 0;
transform: translateY(-20px);
transition: var(--transition);
}
.notification.show {
opacity: 1;
transform: translateY(0);
}
.notification.success {
background: var(--success);
}
.notification.error {
background: var(--danger);
}
.loading {
display: inline-block;
width: 20px;
height: 20px;
border: 3px solid rgba(255, 255, 255, 0.3);
border-radius: 50%;
border-top-color: white;
animation: spin 1s ease-in-out infinite;
}
@keyframes spin {
to { transform: rotate(360deg); }
}
.dropdown {
position: relative;
display: inline-block;
}
.dropdown-content {
display: none;
position: absolute;
background-color: white;
min-width: 160px;
box-shadow: var(--shadow);
z-index: 1;
border-radius: 6px;
overflow: hidden;
}
.dropdown-content a {
color: var(--dark);
padding: 8px 12px;
text-decoration: none;
display: block;
font-size: 14px;
}
.dropdown-content a:hover {
background-color: var(--light);
}
/* Responsive design */
@media (max-width: 1024px) {
.dashboard {
grid-template-columns: 1fr;
}
.charts-container {
grid-template-columns: 1fr;
}
}
@media (max-width: 768px) {
.container {
padding: 10px;
}
.header {
flex-direction: column;
text-align: center;
gap: 15px;
}
.search-box {
width: 100%;
}
.leads-table {
font-size: 14px;
}
.leads-table th,
.leads-table td {
padding: 8px 10px;
}
.action-buttons {
flex-direction: column;
}
}
</style>
</head>
<body>
<div class="container">
<div class="header">
<div style="display: flex; align-items: center; gap: 15px;">
<div class="logo">
<i class="fas fa-dna"></i>
</div>
<div>
<h1>Genetech Solutions</h1>
<p>Mail Agent Dashboard</p>
</div>
</div>
<div class="logo">
<i class="fas fa-envelope"></i>
</div>
</div>
<div class="dashboard">
<div class="stats-card">
<h2><i class="fas fa-chart-bar"></i> Lead Statistics</h2>
<div id="stats-container">
<div class="stat-item">
<span class="stat-label">Total Leads</span>
<span class="stat-value" id="total-leads">-</span>
</div>
<div id="status-stats">
<!-- Status stats will be populated here -->
</div>
</div>
</div>
<div class="charts-card">
<h2><i class="fas fa-chart-pie"></i> Analytics</h2>
<div class="charts-container">
<div class="chart">
<h3>Status Distribution</h3>
<canvas id="status-chart"></canvas>
</div>
<div class="chart">
<h3>Daily Leads</h3>
<canvas id="daily-chart"></canvas>
</div>
</div>
</div>
</div>
<div class="leads-section">
<div class="leads-header">
<h2><i class="fas fa-users"></i> Leads Management</h2>
<div class="search-box">
<i class="fas fa-search"></i>
<input type="text" id="search-input" placeholder="Search leads...">
</div>
</div>
<div class="table-container">
<table class="leads-table">
<thead>
<tr>
<th>ID</th>
<th>Date</th>
<th>Email</th>
<th>Project Description</th>
<th>Status</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="leads-tbody">
<!-- Leads will be populated here -->
</tbody>
</table>
</div>
</div>
</div>
<!-- Email Modal -->
<div id="email-modal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h3><i class="fas fa-envelope"></i> Send Email</h3>
<button class="modal-close" onclick="closeModal()">&times;</button>
</div>
<div class="modal-body">
<div class="form-group">
<label for="email-recipient">Recipient</label>
<input type="email" id="email-recipient" readonly>
</div>
<div class="form-group">
<label for="email-context">Additional Context (Optional)</label>
<textarea id="email-context" placeholder="Add any additional context or specific points to include in the email..."></textarea>
</div>
<div class="form-group">
<label>Generated Email Preview</label>
<div class="email-preview">
<h4>Subject: <span id="email-subject">-</span></h4>
<div class="email-content" id="email-body">-</div>
</div>
</div>
</div>
<div class="modal-footer">
<button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
<button class="btn btn-primary" id="generate-email-btn" onclick="generateEmail()">
<i class="fas fa-magic"></i> Generate Email
</button>
<button class="btn btn-primary" id="send-email-btn" onclick="sendEmail()" style="display: none;">
<i class="fas fa-paper-plane"></i> Send Email
</button>
</div>
</div>
</div>
<!-- Notification -->
<div id="notification" class="notification"></div>
<script>
// Global variables
let leads = [];
let currentLeadId = null;
let generatedEmail = null;
let statusChart = null;
let dailyChart = null;

// Initialize the dashboard
document.addEventListener('DOMContentLoaded', function() {
loadStatistics();
loadLeads();
// Search functionality
document.getElementById('search-input').addEventListener('input', function(e) {
const searchTerm = e.target.value.toLowerCase();
filterLeads(searchTerm);
});
});

// Load statistics and charts
function loadStatistics() {
fetch('/api/statistics')
.then(response => response.json())
.then(data => {
// Update statistics
document.getElementById('total-leads').textContent = data.statistics.total_leads;
// Update status stats
const statusStatsContainer = document.getElementById('status-stats');
statusStatsContainer.innerHTML = '';
data.statistics.status_counts.forEach(item => {
const statusItem = document.createElement('div');
statusItem.className = 'stat-item';
statusItem.innerHTML = `
<span class="stat-label">${item.status.charAt(0).toUpperCase() + item.status.slice(1)}</span>
<span class="stat-value">${item.count}</span>
`;
statusStatsContainer.appendChild(statusItem);
});
// Update charts
if (data.charts.status_chart_data) {
createStatusChart(data.charts.status_chart_data);
}
if (data.charts.daily_chart_data) {
createDailyChart(data.charts.daily_chart_data);
}
})
.catch(error => {
showNotification('Error loading statistics', 'error');
console.error('Error loading statistics:', error);
});
}

// Create status distribution chart
function createStatusChart(data) {
const ctx = document.getElementById('status-chart').getContext('2d');
// Destroy existing chart if it exists
if (statusChart) {
statusChart.destroy();
}
statusChart = new Chart(ctx, {
type: 'doughnut',
data: {
labels: data.labels,
datasets: [{
data: data.values,
backgroundColor: [
'rgba(76, 175, 80, 0.7)', // New Lead - green
'rgba(33, 150, 243, 0.7)', // Contacted - blue
'rgba(255, 152, 0, 0.7)', // Qualified - orange
'rgba(244, 67, 54, 0.7)' // Closed - red
],
borderColor: [
'rgba(76, 175, 80, 1)',
'rgba(33, 150, 243, 1)',
'rgba(255, 152, 0, 1)',
'rgba(244, 67, 54, 1)'
],
borderWidth: 1,
hoverOffset: 4
}]
},
options: {
responsive: true,
maintainAspectRatio: false,
plugins: {
legend: {
position: 'bottom',
labels: {
font: {
size: 14,
weight: 'bold'
},
padding: 20
}
},
tooltip: {
callbacks: {
label: function(context) {
const label = context.label || '';
const value = context.raw || 0;
const total = context.dataset.data.reduce((a, b) => a + b, 0);
const percentage = Math.round((value / total) * 100);
return `${label}: ${value} (${percentage}%)`;
}
}
}
},
cutout: '50%'
}
});
}

// Create daily leads chart
function createDailyChart(data) {
const ctx = document.getElementById('daily-chart').getContext('2d');
// Destroy existing chart if it exists
if (dailyChart) {
dailyChart.destroy();
}
dailyChart = new Chart(ctx, {
type: 'bar',
data: {
labels: data.labels,
datasets: [{
label: 'Number of Leads',
data: data.values,
backgroundColor: 'rgba(198, 40, 40, 0.7)',
borderColor: 'rgba(198, 40, 40, 1)',
borderWidth: 1,
borderRadius: 5,
hoverBackgroundColor: 'rgba(198, 40, 40, 0.9)'
}]
},
options: {
responsive: true,
maintainAspectRatio: false,
plugins: {
legend: {
display: false
},
tooltip: {
backgroundColor: 'rgba(0, 0, 0, 0.8)',
titleFont: {
size: 14,
weight: 'bold'
},
bodyFont: {
size: 14
},
padding: 12,
cornerRadius: 8
}
},
scales: {
y: {
beginAtZero: true,
ticks: {
precision: 0,
font: {
size: 12
}
},
grid: {
color: 'rgba(0, 0, 0, 0.05)'
}
},
x: {
ticks: {
font: {
size: 12
}
},
grid: {
display: false
}
}
}
}
});
}

// Load leads
function loadLeads() {
fetch('/api/leads')
.then(response => response.json())
.then(data => {
leads = data;
displayLeads(leads);
})
.catch(error => {
showNotification('Error loading leads', 'error');
console.error('Error loading leads:', error);
});
}

// Display leads in the table
function displayLeads(leadsToDisplay) {
const tbody = document.getElementById('leads-tbody');
tbody.innerHTML = '';
if (leadsToDisplay.length === 0) {
tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px;">No leads found</td></tr>';
return;
}
leadsToDisplay.forEach(lead => {
const row = document.createElement('tr');
// Format date
const date = new Date(lead.date);
const formattedDate = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
// Truncate project description if too long
const truncatedDescription = lead.project_description.length > 50
? lead.project_description.substring(0, 50) + '...'
: lead.project_description;
row.innerHTML = `
<td>${lead.id}</td>
<td>${formattedDate}</td>
<td>${lead.email}</td>
<td title="${lead.project_description}">${truncatedDescription}</td>
<td><span class="status-badge status-${lead.status.toLowerCase().replace(' ', '-')}">${lead.status}</span></td>
<td>
<div class="action-buttons">
<button class="btn btn-primary" onclick="openEmailModal(${lead.id})">
<i class="fas fa-envelope"></i> Email
</button>
<div class="dropdown">
<button class="btn btn-secondary" onclick="toggleStatusDropdown(${lead.id})">
<i class="fas fa-edit"></i> Status
</button>
<div id="status-dropdown-${lead.id}" class="dropdown-content" style="display: none;">
<a href="#" onclick="updateStatus(${lead.id}, 'New Lead')">New Lead</a>
<a href="#" onclick="updateStatus(${lead.id}, 'Contacted')">Contacted</a>
<a href="#" onclick="updateStatus(${lead.id}, 'Qualified')">Qualified</a>
<a href="#" onclick="updateStatus(${lead.id}, 'Closed')">Closed</a>
</div>
</div>
</div>
</td>
`;
tbody.appendChild(row);
});
}

// Filter leads based on search term
function filterLeads(searchTerm) {
const filteredLeads = leads.filter(lead => {
return (
lead.email.toLowerCase().includes(searchTerm) ||
lead.project_description.toLowerCase().includes(searchTerm) ||
lead.status.toLowerCase().includes(searchTerm)
);
});
displayLeads(filteredLeads);
}

// Toggle status dropdown
function toggleStatusDropdown(leadId) {
const dropdown = document.getElementById(`status-dropdown-${leadId}`);
// Close all other dropdowns
document.querySelectorAll('.dropdown-content').forEach(d => {
if (d.id !== `status-dropdown-${leadId}`) {
d.style.display = 'none';
}
});
// Toggle current dropdown
dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
}

// Update lead status
function updateStatus(leadId, status) {
fetch(`/api/leads/${leadId}`, {
method: 'PUT',
headers: {
'Content-Type': 'application/json',
},
body: JSON.stringify({ status: status }),
})
.then(response => response.json())
.then(data => {
if (data.success) {
showNotification('Lead status updated successfully', 'success');
loadLeads();
loadStatistics();
} else {
showNotification('Failed to update lead status', 'error');
}
})
.catch(error => {
showNotification('Error updating lead status', 'error');
console.error('Error updating lead status:', error);
});
// Close dropdown
document.getElementById(`status-dropdown-${leadId}`).style.display = 'none';
}

// Open email modal
function openEmailModal(leadId) {
currentLeadId = leadId;
// Get lead details
fetch(`/api/leads/${leadId}`)
.then(response => response.json())
.then(lead => {
document.getElementById('email-recipient').value = lead.email;
document.getElementById('email-context').value = '';
document.getElementById('email-subject').textContent = '-';
document.getElementById('email-body').textContent = '-';
// Reset buttons
document.getElementById('generate-email-btn').style.display = 'inline-flex';
document.getElementById('send-email-btn').style.display = 'none';
// Show modal
document.getElementById('email-modal').style.display = 'flex';
})
.catch(error => {
showNotification('Error loading lead details', 'error');
console.error('Error loading lead details:', error);
});
}

// Close modal
function closeModal() {
document.getElementById('email-modal').style.display = 'none';
}

// Generate email
function generateEmail() {
const context = document.getElementById('email-context').value;
// Show loading
const generateBtn = document.getElementById('generate-email-btn');
generateBtn.innerHTML = '<div class="loading"></div> Generating...';
generateBtn.disabled = true;

fetch('/api/send-email', {
method: 'POST',
headers: {
'Content-Type': 'application/json',
},
body: JSON.stringify({
lead_id: currentLeadId,
context: context
}),
})
.then(response => response.json())
.then(data => {
// Reset button
generateBtn.innerHTML = '<i class="fas fa-magic"></i> Generate Email';
generateBtn.disabled = false;
if (data.success) {
// Store generated email
generatedEmail = {
subject: data.subject,
body: data.body
};
// Update preview
document.getElementById('email-subject').textContent = data.subject;
document.getElementById('email-body').textContent = data.body;
// Show send button
document.getElementById('send-email-btn').style.display = 'inline-flex';
showNotification('Email generated successfully', 'success');
} else {
showNotification('Failed to generate email', 'error');
}
})
.catch(error => {
// Reset button
generateBtn.innerHTML = '<i class="fas fa-magic"></i> Generate Email';
generateBtn.disabled = false;
showNotification('Error generating email', 'error');
console.error('Error generating email:', error);
});
}

// Send email
function sendEmail() {
if (!generatedEmail) return;
// Show loading
const sendBtn = document.getElementById('send-email-btn');
sendBtn.innerHTML = '<div class="loading"></div> Sending...';
sendBtn.disabled = true;

fetch('/api/send-email-now', {
method: 'POST',
headers: {
'Content-Type': 'application/json',
},
body: JSON.stringify({
lead_id: currentLeadId,
subject: generatedEmail.subject,
body: generatedEmail.body
}),
})
.then(response => response.json())
.then(data => {
// Reset button
sendBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Send Email';
sendBtn.disabled = false;
if (data.success) {
showNotification('Email sent successfully', 'success');
closeModal();
} else {
showNotification('Failed to send email', 'error');
}
})
.catch(error => {
// Reset button
sendBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Send Email';
sendBtn.disabled = false;
showNotification('Error sending email', 'error');
console.error('Error sending email:', error);
});
}

// Show notification
function showNotification(message, type) {
const notification = document.getElementById('notification');
notification.textContent = message;
notification.className = `notification ${type} show`;
// Hide notification after 3 seconds
setTimeout(() => {
notification.classList.remove('show');
}, 3000);
}

// Close dropdowns when clicking outside
document.addEventListener('click', function(event) {
if (!event.target.matches('.dropdown, .dropdown *')) {
document.querySelectorAll('.dropdown-content').forEach(d => {
d.style.display = 'none';
});
}
});
</script>
</body>
</html>